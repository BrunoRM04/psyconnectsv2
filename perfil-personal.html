<!DOCTYPE html>
<html lang="es">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsyConnects | Mi Perfil</title>
    <link rel="stylesheet" href="public/css/styles.css">
    <link rel="shortcut icon" href="public/img/marca/icono-psyconnects.png">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>

<body>

    <div class="barra-promocional">
        <p class="mensaje-promocional">
            üéÅ ¬°Tu primera sesi√≥n con nosotros es totalmente gratis! üéÅ
        </p>
    </div>

    <header class="encabezado-principal">

        <div class="contenedor-logo">
            <a href="index.html"><img src="public/img/marca/logo cuatro.png" alt="Logo del sitio"
                    class="logo-imagen"></a>
        </div>
        <div class="contenedor-iconos">
            <a href="login.html"><i class='bx bx-user icono-cuenta'></i></a>
            <i class='bx bx-menu icono-hamburguesa'></i>
        </div>

    </header>

    <nav class="menu-desplegable" id="menuDesplegable">
        <i class='bx bx-x icono-cerrar' id="cerrarMenu"></i>
        <ul class="lista-navegacion">
            <li><a href="index.html">üè† Inicio</a></li>
            <li><a href="psicologos-disponibles.html">üë• Psic√≥logos Disponibles</a></li>
            <li><a href="nuestra-historia.html">üìñ Nuestra Historia</a></li>
        </ul>
    </nav>

    <section id="bienvenida-usuario" class="seccion-bienvenida-perfil animar-entrada">
        <div class="contenido-bienvenida animacion-demora-1">
            <h2 class="titulo-bienvenida">¬°Bienvenid@ a tu perfil personal! üëã </h2>
            <p class="texto-bienvenida">
                Desde aqu√≠ vas a poder revisar toda la actividad relacionada con tu cuenta y gestionar tu informaci√≥n
                personal.
            </p>
            <p class="texto-bienvenida">
                Pod√©s corregir tus datos, actualizar tu foto de perfil y mantener tu informaci√≥n siempre al d√≠a.
            </p>
            <p class="texto-bienvenida">
                Adem√°s, ten√©s acceso a un calendario para agendar los d√≠as en los que est√°s disponible.
            </p>
            <p class="texto-bienvenida">
                Al formar parte de nuestro Plan Plus en PsyConnects, tu perfil ser√° promovido de manera continua entre
                empresas, organizaciones y otras instituciones que conf√≠an en los profesionales que integran nuestra
                red.
            </p>
        </div>
        <div class="imagen-bienvenida animacion-demora-2">
            <img src="public/img/ilustraciones/ilustracion-6.svg" alt="Ilustraci√≥n de bienvenida al perfil personal" />
        </div>
    </section>

    <main>

        <nav class="barra-navegacion-edicion-perfil">
            <ul class="lista-pasos-edicion">
                <li><button class="boton-paso-edicion" data-seccion="seccion-informacion-personal">1. Informaci√≥n
                        Personal üë§</button></li>
                <li><button class="boton-paso-edicion" data-seccion="seccion-contacto">2. Contacto üìû</button></li>
                <li><button class="boton-paso-edicion" data-seccion="seccion-perfil-profesional">3. Perfil Profesional
                        üíº</button></li>
                <li><button class="boton-paso-edicion" data-seccion="seccion-especialidades">4. Especialidades
                        üß†</button></li>
                <button class="boton-paso-edicion" data-seccion="seccion-redes-sociales">
                    5. Redes Sociales üåê
                </button>
            </ul>
        </nav>

        <div class="contenedor-secciones-edicion">

            <div class="zona-edicion-fondo" id="seccion-informacion-personal">
                <section class="contenedor-edicion-informacion-personal">
                    <h2 class="titulo-edicion-informacion-personal">Informaci√≥n Personal üë§</h2>
                    <form id="formulario-edicion-informacion-personal">
                        <div class="campo-edicion-informacion-personal">
                            <label for="nombre">Nombre</label>
                            <input type="text" id="nombre" name="nombre" required>
                        </div>
                        <div class="campo-edicion-informacion-personal">
                            <label for="apellido">Apellido</label>
                            <input type="text" id="apellido" name="apellido" required>
                        </div>
                        <div class="campo-edicion-informacion-personal">
                            <label for="documento">N√∫mero de documento</label>
                            <input type="text" id="documento" name="documento" required>
                        </div>
                        <div class="campo-edicion-informacion-personal">
                            <label for="correo">Correo electr√≥nico</label>
                            <input type="email" id="correo" name="correo" required>
                        </div>
                        <div class="campo-edicion-informacion-personal">
                            <label for="genero">G√©nero con el que se identifica</label>
                            <select id="genero" name="genero" required>
                                <option value="" disabled selected>Seleccione una opci√≥n</option>
                                <option value="femenino">Femenino</option>
                                <option value="masculino">Masculino</option>
                                <option value="otro">Otro</option>
                                <option value="prefiero-no-decirlo">Prefiero no decirlo</option>
                            </select>
                        </div>
                    </form>
                </section>
            </div>

            <div class="zona-edicion-fondo" id="seccion-contacto" style="display: none;">
                <section class="contenedor-edicion-contacto">
                    <h2 class="titulo-edicion-contacto">Contacto üìû</h2>
                    <form id="formulario-edicion-contacto">
                        <div class="campo-edicion-contacto">
                            <label for="fecha-nacimiento">Fecha de nacimiento</label>
                            <input type="date" id="fecha-nacimiento" name="fecha-nacimiento" required>
                        </div>
                        <div class="campo-edicion-contacto">
                            <label for="pais">Pa√≠s</label>
                            <select id="pais" name="pais" required>
                                <option value="" disabled selected>Seleccione su pa√≠s</option>
                                <option value="uruguay">Uruguay</option>
                                <option value="argentina">Argentina</option>
                                <option value="brasil">Brasil</option>
                                <option value="chile">Chile</option>
                                <option value="paraguay">Paraguay</option>
                                <option value="peru">Per√∫</option>
                                <option value="bolivia">Bolivia</option>
                                <option value="ecuador">Ecuador</option>
                                <option value="colombia">Colombia</option>
                                <option value="venezuela">Venezuela</option>
                                <option value="mexico">M√©xico</option>
                                <option value="panama">Panam√°</option>
                                <option value="costa-rica">Costa Rica</option>
                                <option value="guatemala">Guatemala</option>
                                <option value="el-salvador">El Salvador</option>
                                <option value="honduras">Honduras</option>
                                <option value="nicaragua">Nicaragua</option>
                                <option value="republica-dominicana">Rep√∫blica Dominicana</option>
                            </select>
                        </div>
                        <div class="campo-edicion-contacto">
                            <label for="telefono">Tel√©fono (con c√≥digo de pa√≠s)</label>
                            <div class="grupo-telefono-contacto">
                                <span id="codigo-pais">+598</span>
                                <input type="tel" id="telefono" name="telefono" required placeholder="Ej: 91234567">
                            </div>
                        </div>
                    </form>
                </section>
            </div>

            <div class="zona-edicion-perfil-profesional-fondo" id="seccion-perfil-profesional" style="display: none;">
                <section class="contenedor-edicion-perfil-profesional">
                    <h2 class="titulo-edicion-perfil-profesional">Perfil Profesional üíº</h2>
                    <form id="formulario-edicion-perfil-profesional">

                        <div class="campo-edicion-perfil-profesional">
                            <label for="experiencia">A√±os de experiencia</label>
                            <input type="number" id="experiencia" name="experiencia" required>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label for="foto-perfil">Foto de perfil</label>
                            <input type="file" id="foto-perfil" accept="image/*" required>
                            <small class="mensaje-foto-perfil">Recomendamos que subas una imagen donde tu rostro est√©
                                centrado y visible.</small>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label for="descripcion">Descripci√≥n personal / profesional</label>
                            <textarea id="descripcion" name="descripcion" rows="4" required></textarea>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label>Experiencia profesional</label>
                            <div id="contenedor-experiencia"></div>
                            <button type="button" class="boton-agregar-item-perfil" onclick="agregarExperiencia()">+
                                A√±adir experiencia</button>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label>Certificaciones</label>
                            <div id="contenedor-certificaciones"></div>
                            <button type="button" class="boton-agregar-item-perfil" onclick="agregarCertificacion()">+
                                A√±adir certificaci√≥n</button>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label for="precio">Precio por hora (USD)</label>
                            <input type="number" id="precio" name="precio" required>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label for="modalidad">Modalidad de atenci√≥n</label>
                            <select id="modalidad" name="modalidad" required>
                                <option value="" disabled selected>Seleccione una opci√≥n</option>
                                <option value="online">Online</option>
                                <option value="presencial">Presencial</option>
                                <option value="hibrido">H√≠brido</option>
                            </select>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label for="video">Video de presentaci√≥n (opcional)</label>
                            <input type="url" id="video" name="video" placeholder="Link a YouTube u otro">
                            <input type="file" id="video-archivo" accept="video/*">
                            <div id="video-preview"></div>
                        </div>

                        <div class="campo-edicion-perfil-profesional">
                            <label for="documentos">Documentos adjuntos (CV, matr√≠cula, etc.)</label>
                            <input type="file" id="documentos" multiple>
                            <div id="documentos-preview"></div>
                        </div>

                    </form>
                </section>
            </div>

            <section id="seccion-especialidades" class="zona-edicion-especialidades-fondo" style="display: none;">
                <div class="zona-edicion-especialidades">
                    <h2 class="titulo-formulario">Especialidades üß†</h2>

                    <form id="formulario-especialidades">

                        <div class="grupo-campo-especialidades">
                            <label>Selecciona hasta 3 tipos de terapia</label>
                            <div class="contenedor-opciones-especialidades" id="terapias">
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="terapia">Cognitivo-conductual</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="terapia">Psicoan√°lisis</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="terapia">Humanista</button>
                                <button type="button" class="opcion-especialidad" data-grupo="terapia">Gestalt</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="terapia">Sist√©mica</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="terapia">Narrativa</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="terapia">Mindfulness</button>
                                <button type="button" class="opcion-especialidad" data-grupo="terapia">EMDR</button>
                            </div>
                        </div>

                        <div class="grupo-campo-especialidades">
                            <label>Idiomas hablados</label>
                            <div class="contenedor-opciones-especialidades" id="idiomas">
                                <button type="button" class="opcion-especialidad" data-grupo="idioma">Espa√±ol</button>
                                <button type="button" class="opcion-especialidad" data-grupo="idioma">Ingl√©s</button>
                                <button type="button" class="opcion-especialidad" data-grupo="idioma">Chino</button>
                                <button type="button" class="opcion-especialidad" data-grupo="idioma">Hindi</button>
                                <button type="button" class="opcion-especialidad" data-grupo="idioma">√Årabe</button>
                                <button type="button" class="opcion-especialidad" data-grupo="idioma">Franc√©s</button>
                            </div>
                        </div>

                        <div class="grupo-campo-especialidades">
                            <label>Especializaci√≥n o √°rea de enfoque</label>
                            <div class="contenedor-opciones-especialidades" id="enfoques">
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Ansiedad</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="enfoque">Depresi√≥n</button>
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Duelo</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="enfoque">Autoestima</button>
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Estr√©s</button>
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Fobias</button>
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Trauma</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="enfoque">Adicciones</button>
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Pareja</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="enfoque">Infanto-juvenil</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="enfoque">Sexualidad</button>
                                <button type="button" class="opcion-especialidad" data-grupo="enfoque">Trastornos
                                    alimenticios</button>
                                <button type="button" class="opcion-especialidad"
                                    data-grupo="enfoque">Neurodivergencias</button>
                            </div>
                        </div>

                    </form>
                </div>
            </section>

            <section id="seccion-redes-sociales" class="zona-edicion-redes-sociales-fondo" style="display: none;">
                <div class="zona-edicion-redes-sociales">
                    <h2 class="titulo-formulario">Redes Sociales üåê</h2>

                    <form id="formulario-redes-sociales">
                        <div class="campo-edicion-redes-sociales">
                            <label for="instagram">Instagram</label>
                            <input type="url" id="instagram" name="instagram"
                                placeholder="https://instagram.com/usuario">
                        </div>

                        <div class="campo-edicion-redes-sociales">
                            <label for="facebook">Facebook</label>
                            <input type="url" id="facebook" name="facebook" placeholder="https://facebook.com/usuario">
                        </div>

                        <div class="campo-edicion-redes-sociales">
                            <label for="linkedin">LinkedIn</label>
                            <input type="url" id="linkedin" name="linkedin"
                                placeholder="https://linkedin.com/in/usuario">
                        </div>

                        <div class="campo-edicion-redes-sociales">
                            <label for="tiktok">TikTok</label>
                            <input type="url" id="tiktok" name="tiktok" placeholder="https://tiktok.com/@usuario">
                        </div>
                    </form>
                </div>
            </section>

        </div>

        <section class="zona-botones-final">
            <div class="contenedor-botones-final">
                <button class="boton-guardar-cambios">üíæ Guardar cambios</button>
                <button class="boton-eliminar-perfil">üóëÔ∏è Eliminar perfil</button>
            </div>
        </section>

        <section class="franja-informacion-visual-psicologo">
            <div class="contenedor-circulos-informacion">
                <div class="circulo-informacion">
                    <p class="texto-circulo-numero" id="contador-visitas-perfil">0</p>
                    <p class="texto-circulo-label">Visitas al perfil</p>
                </div>
                <div class="circulo-informacion">
                    <p class="texto-circulo-numero" id="contador-vistas-video">0</p>
                    <p class="texto-circulo-label">Vistas del video</p>
                </div>
            </div>
        </section>

        <h2 class="titulo-general-disponibilidad">Disponibilidad horaria</h2>
        <p class="parrafo-explicativo-disponibilidad">
            Selecciona los d√≠as y horarios en los que est√°s disponible para recibir consultas.
        </p>

        <section class="seccion-editar-disponibilidad">
            <div class="contenedor-bloques-horario" id="contenedor-bloques-horario">
                <!-- Bloques horarios se insertan aqu√≠ -->
            </div>

            <div class="contenedor-botones-disponibilidad">
                <button type="button" class="boton-agregar-horario" id="boton-agregar-horario">Agregar
                    horario ‚ûï</button>
                <button type="button" class="boton-guardar-horario" id="boton-guardar-horario">Guardar horarios
                    ‚úÖ</button>
            </div>
        </section>

    </main>

    <footer class="pie-pagina">

        <div class="contenedor-pie">
            <div class="columna sobre-nosotros">
                <h3 class="titulo-columna">Sobre nosotros</h3>
                <ul class="lista-enlaces">
                    <li><a href="#">¬øQui√©nes somos?</a></li>
                    <li><a href="#">Misi√≥n y visi√≥n</a></li>
                    <li><a href="#">Noticias</a></li>
                    <li><a href="#">Trabaja con nosotros</a></li>
                </ul>
            </div>

            <div class="columna navegacion">
                <h3 class="titulo-columna">Navegaci√≥n</h3>
                <ul class="lista-enlaces">
                    <li><a href="#">Inicio</a></li>
                    <li><a href="#">Psic√≥logos</a></li>
                    <li><a href="#">Testimonios</a></li>
                    <li><a href="#">Registro / Login</a></li>
                </ul>
            </div>

            <div class="columna contacto-redes">
                <h3 class="titulo-columna">Redes sociales</h3>
                <div class="iconos-redes">
                    <a href="https://www.instagram.com/psyconnectsweb/"><i class='bx bxl-instagram'></i></a>
                    <a href="https://www.facebook.com/profile.php?id=61577232808057"><i class='bx bxl-facebook'></i></a>
                    <a href="https://www.linkedin.com/company/psyconnects/"><i class='bx bxl-linkedin'></i></a>
                </div>
            </div>
        </div>

        <div class="barra-inferior">
            <p>¬© 2025 PsyConnects. Todos los derechos reservados.</p>
            <div class="enlaces-legales">
                <a href="#">Cookies</a>
                <span class="separador-legales">|</span>
                <a href="#">Accesibilidad</a>
                <span class="separador-legales">|</span>
                <a href="#">Aviso legal</a>
            </div>
        </div>

    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";
        import { deleteUser } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
        import { deleteDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        import { deleteObject, listAll } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";
        import { onSnapshot } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCFrMomIGmjYdJdXswCEwJT62JJtyyY4UM",
            authDomain: "psyconnects-web.firebaseapp.com",
            projectId: "psyconnects-web",
            storageBucket: "psyconnects-web.firebasestorage.app",
            messagingSenderId: "172678256167",
            appId: "1:172678256167:web:a490df1ae64f551a9c2002"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        let uid = null;

        async function inicializarContadores(uid) {
            const docRef = doc(db, "usuarios_plus", uid);
            const docSnap = await getDoc(docRef);

            if (!docSnap.exists()) {
                await setDoc(docRef, {
                    visitasPerfil: 1,
                    vistasVideo: 0
                }, { merge: true });

                document.getElementById("contador-visitas-perfil").textContent = 1;
            } else {
                const datos = docSnap.data();
                const visitasActuales = datos.visitasPerfil || 0;
                const vistasVideoActuales = datos.vistasVideo || 0;

                document.getElementById("contador-visitas-perfil").textContent = visitasActuales + 1;

                await setDoc(docRef, {
                    visitasPerfil: visitasActuales + 1
                }, { merge: true });
            }
        }

        async function eliminarArchivosUsuario(uid) {
            const carpetas = [
                `fotos-perfil/${uid}`,
                `videos-presentacion/${uid}`,
                `documentos-adjuntos/${uid}`
            ];

            for (const carpeta of carpetas) {
                const folderRef = ref(storage, carpeta);
                try {
                    const lista = await listAll(folderRef);
                    for (const item of lista.items) {
                        await deleteObject(item);
                    }
                } catch (error) {
                    console.warn("No se pudo eliminar carpeta o estaba vac√≠a:", carpeta);
                }
            }
        }

        document.querySelector(".boton-eliminar-perfil").addEventListener("click", async () => {
            const confirmar = confirm("¬øEst√°s seguro de que quer√©s eliminar tu perfil? Esta acci√≥n es irreversible.");
            if (!confirmar) return;

            const usuario = JSON.parse(localStorage.getItem("usuarioPlus"));
            if (!usuario || !usuario.uid) {
                alert("No se detect√≥ el usuario. Por favor, inicia sesi√≥n.");
                return;
            }

            try {
                await eliminarArchivosUsuario(usuario.uid);
                await deleteDoc(doc(db, "usuarios_plus", usuario.uid));

                const user = auth.currentUser;
                if (user) await deleteUser(user);

                localStorage.removeItem("usuarioPlus");

                alert("‚úÖ Perfil eliminado correctamente.");
                window.location.href = "index.html";
            } catch (error) {
                console.error("Error al eliminar el perfil:", error);
                alert("‚ùå Hubo un error al eliminar tu perfil. Intentalo nuevamente.");
            }
        });

        const botonesPasos = document.querySelectorAll('.boton-paso-edicion');
        const secciones = document.querySelectorAll(
            '.zona-edicion-fondo, .zona-edicion-informacion-personal-fondo, .zona-edicion-contacto-fondo, .zona-edicion-perfil-profesional-fondo, .zona-edicion-especialidades-fondo, .zona-edicion-redes-sociales-fondo'
        );

        botonesPasos.forEach(boton => {
            boton.addEventListener('click', () => {
                const idObjetivo = boton.getAttribute('data-seccion');
                secciones.forEach(seccion => {
                    seccion.style.display = (seccion.id === idObjetivo) ? 'block' : 'none';
                });
            });
        });

        window.agregarExperiencia = function () {
            const contenedor = document.getElementById('contenedor-experiencia');
            const div = document.createElement('div');
            div.className = 'item-experiencia-perfil';
            div.innerHTML = `
      <input type="text" placeholder="Lugar de trabajo" required>
      <input type="text" placeholder="Per√≠odo (Ej: 2020-2023)" required>
      <input type="text" placeholder="Tareas realizadas" required>

      <button type="button" class="boton-toggle-actualmente" data-activo="false">üîµ Actualmente no trabajo aqu√≠</button>

      <button type="button" class="boton-eliminar-bloque" onclick="this.parentElement.remove()">üóëÔ∏è Eliminar experiencia</button>
    `;

            contenedor.appendChild(div);
            const toggle = div.querySelector('.boton-toggle-actualmente');
            toggle.addEventListener('click', () => {
                const activo = toggle.getAttribute('data-activo') === "true";
                toggle.setAttribute('data-activo', !activo);
                toggle.textContent = !activo ? "üü¢ Actualmente trabajo aqu√≠" : "üîµ Actualmente no trabajo aqu√≠";
                toggle.classList.toggle('activo');
            });
        };

        window.agregarCertificacion = function () {
            const contenedor = document.getElementById('contenedor-certificaciones');
            const div = document.createElement('div');
            div.className = 'item-certificacion-perfil';
            div.innerHTML = `
      <input type="text" placeholder="Nombre de la certificaci√≥n" required>
      <input type="text" placeholder="A√±o de inicio" required>
      <input type="text" placeholder="A√±o de finalizaci√≥n" required>
      <button type="button" class="boton-eliminar-bloque" onclick="this.parentElement.remove()">üóëÔ∏è Eliminar certificaci√≥n</button>
    `;
            contenedor.appendChild(div);
        };

        document.querySelectorAll('.opcion-especialidad').forEach(boton => {
            boton.addEventListener('click', () => {
                const grupo = boton.getAttribute('data-grupo');
                const seleccionadas = document.querySelectorAll(`.opcion-especialidad[data-grupo="${grupo}"].seleccionada`);

                if (boton.classList.contains('seleccionada')) {
                    boton.classList.remove('seleccionada');
                    return;
                }

                if (seleccionadas.length < 3) {
                    boton.classList.add('seleccionada');
                } else {
                    alert("Puedes seleccionar hasta 3 opciones en esta categor√≠a.");
                }
            });
        });


        document.addEventListener('DOMContentLoaded', () => {
            const codigosPorPais = {
                'uruguay': '+598', 'argentina': '+54', 'brasil': '+55', 'chile': '+56',
                'paraguay': '+595', 'peru': '+51', 'bolivia': '+591', 'ecuador': '+593',
                'colombia': '+57', 'venezuela': '+58', 'mexico': '+52', 'panama': '+507',
                'costa-rica': '+506', 'guatemala': '+502', 'el-salvador': '+503',
                'honduras': '+504', 'nicaragua': '+505', 'republica-dominicana': '+1'
            };

            const usuario = JSON.parse(localStorage.getItem("usuarioPlus"));
            if (!usuario) {
                alert("No se encontraron datos del usuario. Por favor, inicia sesi√≥n.");
                window.location.href = "login.html";
                return;
            }

            inicializarContadores(usuario.uid);
            const docRef = doc(db, "usuarios_plus", usuario.uid);
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const datos = docSnap.data();
                    const vistasVideoActuales = datos.vistasVideo || 0;
                    document.getElementById("contador-vistas-video").textContent = vistasVideoActuales;
                }
            });
            cargarHorariosGuardados(usuario.uid);

            document.getElementById('nombre').value = usuario.nombre || "";
            document.getElementById('apellido').value = usuario.apellido || "";
            document.getElementById('documento').value = usuario.documento || "";
            document.getElementById('correo').value = usuario.correo || "";
            document.getElementById('genero').value = usuario.genero || "";

            document.getElementById('fecha-nacimiento').value = usuario.fechaNacimiento || "";
            document.getElementById('pais').value = usuario.pais || "";
            document.getElementById('telefono').value = usuario.telefono || "";

            const codigoElemento = document.getElementById('codigo-pais');
            const paisSelect = document.getElementById('pais');
            const actualizarCodigoPais = () => {
                const pais = paisSelect.value;
                const codigo = codigosPorPais[pais] || '';
                if (codigoElemento) codigoElemento.textContent = codigo;
            };
            actualizarCodigoPais();
            paisSelect.addEventListener('change', actualizarCodigoPais);

            document.getElementById('experiencia').value = usuario.experiencia || "";
            document.getElementById('descripcion').value = usuario.descripcion || "";
            document.getElementById('precio').value = usuario.precio || "";
            document.getElementById('modalidad').value = usuario.modalidad || "";
            document.getElementById('video').value = usuario.videoLink || "";

            document.getElementById('instagram').value = usuario.instagram || "";
            document.getElementById('facebook').value = usuario.facebook || "";
            document.getElementById('linkedin').value = usuario.linkedin || "";
            document.getElementById('tiktok').value = usuario.tiktok || "";

            if (usuario.fotoPerfilURL) {
                const img = document.createElement('img');
                img.src = usuario.fotoPerfilURL;
                img.alt = "Foto de perfil";
                img.style.maxWidth = "150px";
                const inputFoto = document.getElementById('foto-perfil');
                inputFoto.insertAdjacentElement('beforebegin', img);
            }

            if (Array.isArray(usuario.experienciaProfesional)) {
                usuario.experienciaProfesional.forEach(exp => {
                    agregarExperiencia();
                    const inputs = document.querySelectorAll('#contenedor-experiencia .item-experiencia-perfil:last-child input');
                    if (inputs.length >= 3) {
                        inputs[0].value = exp.lugar;
                        inputs[1].value = exp.periodo;
                        inputs[2].value = exp.tareas;
                        const toggle = document.querySelector('#contenedor-experiencia .boton-toggle-actualmente:last-child');
                        if (exp.actualmente && toggle) toggle.click();
                    }
                });
            }

            if (Array.isArray(usuario.certificaciones)) {
                usuario.certificaciones.forEach(cert => {
                    agregarCertificacion();
                    const inputs = document.querySelectorAll('#contenedor-certificaciones .item-certificacion-perfil:last-child input');
                    if (inputs.length >= 3) {
                        inputs[0].value = cert.nombre;
                        inputs[1].value = cert.inicio;
                        inputs[2].value = cert.fin;
                    }
                });
            }

            if (Array.isArray(usuario.documentosAdjuntos)) {
                mostrarArchivosConEliminar(usuario.documentosAdjuntos, "documentos-preview", "archivo");
            }

            if (usuario.videoArchivoURL) {
                mostrarArchivosConEliminar([usuario.videoArchivoURL], "video-preview", "video");
            }

            marcarSeleccionados("terapia", usuario.terapias || []);
            marcarSeleccionados("idioma", usuario.idiomas || []);
            marcarSeleccionados("enfoque", usuario.enfoques || []);
        });

        function marcarSeleccionados(grupo, lista) {
            lista.forEach(valor => {
                const boton = Array.from(document.querySelectorAll(`.opcion-especialidad[data-grupo="${grupo}"]`))
                    .find(btn => btn.textContent.trim().toLowerCase() === valor.toLowerCase());
                if (boton) boton.classList.add('seleccionada');
            });
        }

        function mostrarArchivosConEliminar(listaURLs, contenedorID, tipo = "archivo") {
            const contenedor = document.getElementById(contenedorID);
            contenedor.innerHTML = "";

            listaURLs.forEach((url) => {
                const bloque = document.createElement("div");
                bloque.className = 'item-certificacion-perfil';

                if (tipo === "video") {
                    bloque.innerHTML = `
                <video controls width="100%" src="${url}"></video>
                <button type="button" class="boton-eliminar-bloque" onclick="this.parentElement.remove()">üóëÔ∏è Eliminar video</button>
            `;
                } else {
                    const nombreArchivo = decodeURIComponent(url.split("/").pop().split("?")[0]);
                    bloque.innerHTML = `
                <p>üìé ${nombreArchivo}</p>
                <a href="${url}" target="_blank">Ver documento</a><br>
                <button type="button" class="boton-eliminar-bloque" onclick="this.parentElement.remove()">üóëÔ∏è Eliminar documento</button>
            `;
                }

                contenedor.appendChild(bloque);
            });
        }

        document.querySelector(".boton-guardar-cambios").addEventListener("click", async () => {
            const usuario = JSON.parse(localStorage.getItem("usuarioPlus"));
            if (!usuario || !usuario.uid) {
                alert("No se detect√≥ el usuario. Por favor, inicia sesi√≥n.");
                return;
            }

            const usuarioRef = doc(db, "usuarios_plus", usuario.uid);

            const experiencia = [...document.querySelectorAll('#contenedor-experiencia .item-experiencia-perfil')].map(div => ({
                lugar: div.children[0].value,
                periodo: div.children[1].value,
                tareas: div.children[2].value,
                actualmente: div.querySelector('.boton-toggle-actualmente')?.getAttribute('data-activo') === "true"
            }));

            const certificaciones = [...document.querySelectorAll('#contenedor-certificaciones .item-certificacion-perfil')].map(div => ({
                nombre: div.children[0].value,
                inicio: div.children[1].value,
                fin: div.children[2].value
            }));

            const terapias = [...document.querySelectorAll('.opcion-especialidad[data-grupo="terapia"].seleccionada')].map(btn => btn.textContent.trim());
            const idiomas = [...document.querySelectorAll('.opcion-especialidad[data-grupo="idioma"].seleccionada')].map(btn => btn.textContent.trim());
            const enfoques = [...document.querySelectorAll('.opcion-especialidad[data-grupo="enfoque"].seleccionada')].map(btn => btn.textContent.trim());

            const datosActualizados = {
                nombre: document.getElementById('nombre').value,
                apellido: document.getElementById('apellido').value,
                documento: document.getElementById('documento').value,
                correo: document.getElementById('correo').value,
                genero: document.getElementById('genero').value,
                fechaNacimiento: document.getElementById('fecha-nacimiento').value,
                pais: document.getElementById('pais').value,
                telefono: document.getElementById('telefono').value,
                experiencia: document.getElementById('experiencia').value,
                descripcion: document.getElementById('descripcion').value,
                precio: document.getElementById('precio').value,
                modalidad: document.getElementById('modalidad').value,
                videoLink: document.getElementById('video').value,
                instagram: document.getElementById('instagram').value,
                facebook: document.getElementById('facebook').value,
                linkedin: document.getElementById('linkedin').value,
                tiktok: document.getElementById('tiktok').value,
                experienciaProfesional: experiencia,
                certificaciones,
                terapias,
                idiomas,
                enfoques
            };

            const archivoFoto = document.getElementById('foto-perfil').files[0];
            if (archivoFoto) {
                const fotoRef = ref(storage, `fotos-perfil/${usuario.uid}`);
                await uploadBytes(fotoRef, archivoFoto);
                datosActualizados.fotoPerfilURL = await getDownloadURL(fotoRef);
            }

            const archivoVideo = document.getElementById('video-archivo').files[0];
            if (archivoVideo) {
                const videoRef = ref(storage, `videos-presentacion/${usuario.uid}`);
                await uploadBytes(videoRef, archivoVideo);
                datosActualizados.videoArchivoURL = await getDownloadURL(videoRef);
            }

            const archivosDocumentos = document.getElementById('documentos').files;
            if (archivosDocumentos.length > 0) {
                const urls = [];
                for (let archivo of archivosDocumentos) {
                    const docRef = ref(storage, `documentos-adjuntos/${usuario.uid}/${archivo.name}`);
                    await uploadBytes(docRef, archivo);
                    const url = await getDownloadURL(docRef);
                    urls.push(url);
                }
                datosActualizados.documentosAdjuntos = urls;
            }

            try {
                await updateDoc(usuarioRef, datosActualizados);
                alert("‚úÖ Cambios guardados correctamente.");
            } catch (error) {
                console.error("Error al guardar en Firestore:", error);
                alert("‚ùå Hubo un error al guardar los cambios.");
            }
        });

        function obtenerProximosDias(cantidad) {
            const opciones = [];
            const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            const meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio',
                'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];

            const hoy = new Date();

            for (let i = 0; i < cantidad; i++) {
                const fecha = new Date(hoy);
                fecha.setDate(hoy.getDate() + i);

                const diaNombre = diasSemana[fecha.getDay()];
                const diaNumero = fecha.getDate();
                const mesNombre = meses[fecha.getMonth()];

                const texto = `${diaNombre} ${diaNumero} de ${mesNombre}`;
                const valor = fecha.toISOString().split('T')[0];

                opciones.push({ texto, valor });
            }

            return opciones;
        }

        function crearBloqueHorario() {
            const div = document.createElement("div");
            div.className = "bloque-horario";

            const fechas = obtenerProximosDias(14);
            const opcionesFecha = fechas.map(f => `<option value="${f.valor}">${f.texto}</option>`).join("");

            div.innerHTML = `
      <select class="campo-dia">
        <option value="">Seleccionar fecha</option>
        ${opcionesFecha}
      </select>
      <input type="time" class="campo-hora-inicio">
      <input type="time" class="campo-hora-fin">
      <button type="button" class="boton-eliminar-horario">‚úñ</button>
    `;

            div.querySelector(".boton-eliminar-horario").addEventListener("click", () => {
                div.remove();
            });

            document.getElementById("contenedor-bloques-horario").appendChild(div);
        }

        document.addEventListener("DOMContentLoaded", () => {
            const botonAgregar = document.getElementById("boton-agregar-horario");
            botonAgregar.addEventListener("click", crearBloqueHorario);
            crearBloqueHorario();
        });

        document.getElementById("boton-guardar-horario").addEventListener("click", async () => {
            const usuario = JSON.parse(localStorage.getItem("usuarioPlus"));
            if (!usuario || !usuario.uid) {
                alert("No se detect√≥ el usuario. Por favor, inicia sesi√≥n.");
                return;
            }

            const bloques = document.querySelectorAll(".bloque-horario");
            const horarios = [];

            bloques.forEach(bloque => {
                const fecha = bloque.querySelector(".campo-dia").value;
                const horaInicio = bloque.querySelector(".campo-hora-inicio").value;
                const horaFin = bloque.querySelector(".campo-hora-fin").value;

                if (fecha && horaInicio && horaFin) {
                    horarios.push({ fecha, horaInicio, horaFin });
                }
            });

            try {
                const usuarioRef = doc(db, "usuarios_plus", usuario.uid);
                await setDoc(usuarioRef, { horariosDisponibles: horarios }, { merge: true });
                alert("‚úÖ Horarios guardados exitosamente.");
            } catch (error) {
                console.error("Error al guardar horarios:", error);
                alert("‚ùå Ocurri√≥ un error al guardar los horarios.");
            }
        });

        async function cargarHorariosGuardados(uid) {
            try {
                const usuarioRef = doc(db, "usuarios_plus", uid);
                const docSnap = await getDoc(usuarioRef);

                if (docSnap.exists()) {
                    const datos = docSnap.data();
                    const horarios = datos.horariosDisponibles || [];

                    const contenedor = document.getElementById("contenedor-bloques-horario");
                    contenedor.innerHTML = ""; // Limpiar bloques previos

                    const fechas = obtenerProximosDias(14);

                    horarios.forEach(horario => {
                        const div = document.createElement("div");
                        div.className = "bloque-horario";

                        const opcionesFecha = fechas.map(f =>
                            `<option value="${f.valor}" ${f.valor === horario.fecha ? "selected" : ""}>${f.texto}</option>`
                        ).join("");

                        div.innerHTML = `
                    <select class="campo-dia">
                        <option value="">Seleccionar fecha</option>
                        ${opcionesFecha}
                    </select>
                    <input type="time" class="campo-hora-inicio" value="${horario.horaInicio}">
                    <input type="time" class="campo-hora-fin" value="${horario.horaFin}">
                    <button type="button" class="boton-eliminar-horario">‚úñ</button>
                `;

                        div.querySelector(".boton-eliminar-horario").addEventListener("click", () => {
                            div.remove();
                        });

                        contenedor.appendChild(div);
                    });
                }
            } catch (error) {
                console.error("Error al cargar horarios desde Firestore:", error);
            }
        }
    </script>


    <script>

        const menu = document.getElementById('menuDesplegable');
        const abrir = document.querySelector('.icono-hamburguesa');
        const cerrar = document.getElementById('cerrarMenu');

        abrir.addEventListener('click', () => {
            menu.classList.add('activo');
        });

        cerrar.addEventListener('click', () => {
            menu.classList.remove('activo');
        });

    </script>

</body>

</html>